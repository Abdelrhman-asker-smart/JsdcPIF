<!-- Table Activity Section -->
<div id="activity" class="tab-content container">
  <div class="bg-white p-8 rounded-[15px] mb-[40px]">
    <div class="flex justify-between flex-wrap items-center">
      <h3 class="text-2xl font-semibold text-black mb-6">Activities</h3>
      <div class="gap-6 flex flex-wrap">
        <button id="btnScanCustomer" class="bg-[#EEF5FA] font-[700] text-[#559BD0] px-10 border border-[#559BD0] py-2 rounded-[8px]">
          New Activity
        </button>
      </div>
    </div>

    <!-- Popup Overlay -->
    <div id="popupOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
      <div id="popupContent" class="bg-white md:p-[48px] p-[24px] rounded-[16px] relative max-w-[91%] animate__animated animate__fadeInUp">
        <!-- Close Icon -->
        <button id="popupCloseBtn" class="absolute w-[40px] h-[40px] rounded-full flex justify-center items-center top-[-17px] right-[-12px] bg-white text-gray-600 text-lg" style="box-shadow: 0px 4px 4px 0px #00000014;">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.4432 10.7734L9.34069 6.90239L13.2117 2.79986C13.4683 2.52784 13.6064 2.16501 13.5956 1.79118C13.5847 1.41735 13.4258 1.06314 13.1538 0.806481C12.8818 0.549818 12.5189 0.411725 12.1451 0.422581C11.7713 0.433437 11.4171 0.592351 11.1604 0.864366L7.28943 4.96689L3.1869 1.09591C2.91488 0.839245 2.55205 0.701152 2.17822 0.712008C1.80439 0.722863 1.45018 0.881778 1.19352 1.15379C0.936857 1.42581 0.798765 1.78864 0.80962 2.16247C0.820476 2.5363 0.97939 2.89051 1.2514 3.14717L5.35393 7.01816L1.48295 11.1207C1.22628 11.3927 1.08819 11.7555 1.09905 12.1294C1.1099 12.5032 1.26882 12.8574 1.54083 13.1141C1.81285 13.3707 2.17568 13.5088 2.54951 13.498C2.92334 13.4871 3.27755 13.3282 3.53421 13.0562L7.4052 8.95365L11.5077 12.8246C11.7797 13.0813 12.1426 13.2194 12.5164 13.2085C12.8902 13.1977 13.2444 13.0388 13.5011 12.7668C13.7578 12.4947 13.8959 12.1319 13.885 11.7581C13.8741 11.3842 13.7152 11.03 13.4432 10.7734Z" fill="#DBDBDB"/>
          </svg>
        </button>
        <div class="overflow-auto md:max-w-[642px] max-w-[90%] max-h-[90%] mx-auto">
          <h3 class="md:text-[20px] text-[16px] font-bold mb-6">Upload Business Card</h3>
          <p class="md:text-[18px] text-[14px] text-[#0D0D0C] font-[400] mb-5">
            a wholly owned subsidiary of the Public Investment Fund, aims to contribute...
          </p>
          <!-- Drag & Drop Area -->
          <div id="dragDropArea" class="border-2 border-dashed border-[#559BD0] rounded-[24px] text-center bg-[#EEF5FA] cursor-pointer hover:bg-blue-50">
            <input type="file" id="fileInput" class="hidden">
            <label for="fileInput" class="p-11 cursor-pointer text-[#559BD0] font-[700] md:text-[20px] text-[16px] flex flex-col justify-center items-center gap-6">
              <p id="fileLabel">Drag&Drop your file or Browse</p>
              <!-- (SVG icon for drag & drop) -->
              <svg width="104" height="102" viewBox="0 0 104 102" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g opacity="0.2">
                  <g clip-path="url(#clip0_432_4057)">
                    <path d="M81.8046 0H22.1428C16.4937 0.00671531 11.0779 2.23673 7.08335 6.20089C3.08882 10.165 0.841728 15.5397 0.834961 21.1458L0.834961 80.3542C0.841728 85.9603 3.08882 91.335 7.08335 95.2991C11.0779 99.2633 16.4937 101.493 22.1428 101.5H81.8046C87.4537 101.493 92.8695 99.2633 96.864 95.2991C100.859 91.335 103.106 85.9603 103.112 80.3542V21.1458C103.106 15.5397 100.859 10.165 96.864 6.20089C92.8695 2.23673 87.4537 0.00671531 81.8046 0V0ZM22.1428 8.45833H81.8046C85.1953 8.45833 88.4472 9.79505 90.8447 12.1744C93.2423 14.5538 94.5893 17.7809 94.5893 21.1458V80.3542C94.5819 82.2382 94.1449 84.0961 93.3108 85.7886L54.2621 47.0368C52.2835 45.0726 49.9343 43.5145 47.3487 42.4515C44.7632 41.3885 41.9919 40.8413 39.1933 40.8413C36.3946 40.8413 33.6234 41.3885 31.0378 42.4515C28.4523 43.5145 26.1031 45.0726 24.1244 47.0368L9.35808 61.6866V21.1458C9.35808 17.7809 10.705 14.5538 13.1026 12.1744C15.5002 9.79505 18.7521 8.45833 22.1428 8.45833ZM22.1428 93.0417C18.7521 93.0417 15.5002 91.7049 13.1026 89.3256C10.705 86.9462 9.35808 83.7191 9.35808 80.3542V73.6467L30.146 53.0168C31.3332 51.8378 32.743 50.9025 34.2946 50.2644C35.8463 49.6263 37.5094 49.2979 39.189 49.2979C40.8686 49.2979 42.5317 49.6263 44.0834 50.2644C45.635 50.9025 47.0448 51.8378 48.232 53.0168L87.2807 91.7729C85.5752 92.6006 83.7031 93.0344 81.8046 93.0417H22.1428Z" fill="#374957"/>
                  </g>
                </g>
                <defs>
                  <clipPath id="clip0_432_4057">
                    <rect width="102.277" height="101.5" fill="white" transform="translate(0.834961)"/>
                  </clipPath>
                </defs>
              </svg>
            </label>
          </div>

          <!-- Error Message -->
          <p id="errorMsg" class="mt-2 text-sm text-red-500 min-h-[18px]"></p>

          <!-- Popup Buttons -->
          <div class="mt-4 flex w-full gap-[17px]">
            <button id="btnSaveSend" class="bg-[#559BD0] text-white px-4 py-[8px] font-[700] rounded-[8px] flex-grow">
              Save, Send
            </button>
            <button id="btnCancelPopup" class="text-[#559BD0] px-4 py-[8px] border border-[#559BD0] rounded-[8px] flex-grow">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="flex gap-3 items-center p-3 border border-[#E6F0F8] rounded-[12px] mt-6 ml-auto w-fit px-6">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_314_994)">
          <path d="M15.8045 14.8625L11.8252 10.8831C12.9096 9.55686 13.4428 7.86453 13.3144 6.15617C13.1861 4.44782 12.406 2.85415 11.1356 1.70481C9.86516 0.555472 8.20158 -0.0616068 6.48895 -0.0187856C4.77632 0.0240356 3.14566 0.723481 1.93426 1.93487C0.72287 3.14627 0.0234252 4.77693 -0.019396 6.48956C-0.0622172 8.20219 0.554862 9.86577 1.7042 11.1362C2.85354 12.4066 4.44721 13.1867 6.15556 13.315C7.86392 13.4434 9.55625 12.9102 10.8825 11.8258L14.8619 15.8051C14.9876 15.9266 15.156 15.9938 15.3308 15.9922C15.5056 15.9907 15.6728 15.9206 15.7964 15.797C15.92 15.6734 15.9901 15.5062 15.9916 15.3314C15.9932 15.1566 15.926 14.9882 15.8045 14.8625Z" fill="#559BD0"/>
        </g>
        <defs>
          <clipPath id="clip0_314_994">
            <rect width="16" height="16" fill="white"/>
          </clipPath>
        </defs>
      </svg>
      <input placeholder="search" class="border-0 text-[#CAE0F0] placeholder:text-[#CAE0F0]">
    </div>
    <div class="overflow-x-auto">
      <table id="activity-table" class="min-w-[966px]">
        <thead class="py-6 bg-[#EEF5FA] w-full">
          <tr>
            <th style="width: 50px">
              <label class="custom-checkbox">
                <input type="checkbox" id="activity-select-all" />
                <span class="checkmark"></span>
              </label>
            </th>
            <th class="sortable gap-2 items-center w-[250px]" data-column="name">
              <p class="text-[16px] font-bold text-[#050504] m-2 ml-0 p-0 float-left">Name</p>
              <div class="flex flex-col arrows mt-auto inline-flex h-[40px] justify-center">
                <svg class="arrow-up" width="16" style="rotate: 180deg" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.00015 1.69234L7.69246 9.38464L15.3848 1.69234L14.2886 0.61541L7.69246 7.21157L1.0963 0.61541L0.00015 1.69234Z" fill="black"/>
                </svg>
                <svg class="arrow-down" width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.00015 1.69234L7.69246 9.38464L15.3848 1.69234L14.2886 0.61541L7.69246 7.21157L1.0963 0.61541L0.00015 1.69234Z" fill="black"/>
                </svg>
              </div>
            </th>
            <th class="sortable gap-2 items-center w-[250px]" data-column="last-name">
              <p class="text-[16px] font-bold text-[#050504] m-2 ml-0 p-0 float-left">Last Name</p>
              <div class="flex flex-col arrows mt-auto inline-flex h-[40px] justify-center">
                <svg class="arrow-up" width="16" style="rotate: 180deg" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.00015 1.69234L7.69246 9.38464L15.3848 1.69234L14.2886 0.61541L7.69246 7.21157L1.0963 0.61541L0.00015 1.69234Z" fill="black"/>
                </svg>
                <svg class="arrow-down" width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.00015 1.69234L7.69246 9.38464L15.3848 1.69234L14.2886 0.61541L7.69246 7.21157L1.0963 0.61541L0.00015 1.69234Z" fill="black"/>
                </svg>
              </div>
            </th>
            <th class="sortable gap-2 items-center w-[250px]" data-column="email">
              <p class="text-[16px] font-bold text-[#050504] m-2 ml-0 p-0 float-left">Email</p>
            </th>
            <th class="sortable gap-2 items-center w-[250px]" data-column="type">
              <p class="text-[16px] font-bold text-[#050504] m-2 ml-0 p-0 float-left">Type</p>
            </th>
            <th data-column="action"></th>
          </tr>
        </thead>
        <tbody id="activity-table-body"></tbody>
      </table>
    </div>
    <!-- Pagination Controls -->
    <div class="flex items-center justify-end mt-4">
      <button id="activity-prevPage" class="h-[24px] p-[4px] w-[24px] rounded-[3px_0px_0px_3px] text-gray-400 bg-gray-200 cursor-not-allowed" disabled>
        <img src="./assets/images/icons8-arrow-50 (1).png" class="w-full h-full"/>
      </button>
      <span id="activity-pageIndicator" hidden class="mx-2 text-[#4E4E4E] font-bold">Page 1</span>
      <button id="activity-nextPage" class="h-[24px] w-[24px] p-[4px] mx-auto inline-block rounded-[0px_3px_3px_0px] text-white bg-[#559BD0]">
        <img src="./assets/images/icons8-arrow-50 (1).png" style="rotate: 180deg;" class="w-full h-full"/>
      </button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="flex justify-between items-center mb-[50px]">
    <div class="flex items-center gap-6 justify-center flex-grow flex-wrap">
      <p id="activity-resultsText" class="flex-grow max-w-[194px] w-full text-center bg-white text-[#4E4E4E] font-bold rounded-[12px] h-[60px] flex items-center justify-center" style="box-shadow: 0px 12px 20px 0px #00000014">
        showing 1 result
      </p>
      <div class="flex-grow max-w-[194px] w-full text-center relative">
        <button id="activity-perPageButton" class="bg-white text-[#4E4E4E] rounded-[12px] h-[60px] w-full flex items-center justify-center" style="box-shadow: 0px 12px 20px 0px #00000014">
          per page <strong id="activity-perPageValue" class="text-[#050504] mx-2">10</strong>
        </button>
        <div id="activity-perPageDropdown" class="hidden absolute mt-3 left-0 top-full w-full bg-white border rounded-[12px] shadow-md z-10">
          <div class="option py-2 cursor-pointer text-black" data-value="10">10</div>
          <div class="option py-2 cursor-pointer text-black" data-value="5">5</div>
          <div class="option py-2 cursor-pointer text-black" data-value="20">20</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Popup Variables
  const btnScanCustomer = document.getElementById('btnScanCustomer');
  const popupOverlay = document.getElementById('popupOverlay');
  const popupOverlayChild = document.getElementById('popupContent');
  const popupCloseBtn = document.getElementById('popupCloseBtn');
  const btnCancelPopup = document.getElementById('btnCancelPopup');
  const dragDropArea = document.getElementById('dragDropArea');
  const btnSaveSend = document.getElementById('btnSaveSend');
  const errorMsg = document.getElementById('errorMsg');
  const fileLabel = document.getElementById('fileLabel');
  const fileInput = document.getElementById('fileInput');

  let selectedFile = null;
  const defaultLabelText = "Drag&Drop your file or Browse";

  // Open Popup
  btnScanCustomer.addEventListener('click', () => {
    popupOverlay.classList.remove('hidden');
    errorMsg.textContent = '';
    selectedFile = null;
    fileInput.value = '';
    fileLabel.textContent = defaultLabelText;
  });

  // Close Popup with a smooth transition
  function closePopup() {
    popupOverlayChild.classList.add("mt-[200%]", "duration-[3s]", "transition-all");
    setTimeout(() => {
      popupOverlay.classList.add("hidden");
      popupOverlayChild.classList.remove("mt-[200%]", "duration-[3s]", "transition-all");
    }, 1500);
    errorMsg.textContent = '';
    selectedFile = null;
    fileInput.value = '';
    fileLabel.textContent = defaultLabelText;
  }
  popupCloseBtn.addEventListener('click', closePopup);
  btnCancelPopup.addEventListener('click', closePopup);

  fileInput.addEventListener('change', (e) => {
    if (e.target.files && e.target.files.length > 0) {
      handleFile(e.target.files[0]);
    }
  });

  function handleFile(file) {
    // File validation/handling logic
    selectedFile = file;
    fileLabel.textContent = "Selected File: " + file.name;
    errorMsg.textContent = '';
  }

  // Sample Activity Data
  const activity = [
    { id: 1, name: "Oli Bob", "last-name": "Bobson", email: "oli@example.com", type: "VIP", selected: false },
    { id: 2, name: "Mary May", "last-name": "Mayberry", email: "mary@example.com", type: "Basic", selected: false },
    { id: 3, name: "John Doe", "last-name": "Doeson", email: "john@example.com", type: "Premium", selected: false },
    { id: 4, name: "Alice Brown", "last-name": "Brownsworth", email: "alice@example.com", type: "Basic", selected: false },
    { id: 5, name: "Charlie Black", "last-name": "Blackwood", email: "charlie@example.com", type: "VIP", selected: false },
    { id: 6, name: "Emma White", "last-name": "Whitestone", email: "emma@example.com", type: "Premium", selected: false },
    { id: 7, name: "David Green", "last-name": "Greenfield", email: "david@example.com", type: "Basic", selected: false },
    { id: 8, name: "Sophia Blue", "last-name": "Bluebell", email: "sophia@example.com", type: "VIP", selected: false },
    { id: 9, name: "James Red", "last-name": "Redmond", email: "james@example.com", type: "Premium", selected: false },
    { id: 10, name: "Olivia Gold", "last-name": "Goldsmith", email: "olivia@example.com", type: "Basic", selected: false },
    { id: 11, name: "Henry Silver", "last-name": "Silverman", email: "henry@example.com", type: "VIP", selected: false },
    { id: 12, name: "Lucas Gray", "last-name": "Graystone", email: "lucas@example.com", type: "Premium", selected: false },
    { id: 13, name: "Mia Rose", "last-name": "Rosewood", email: "mia@example.com", type: "Basic", selected: false },
    { id: 14, name: "Benjamin Violet", "last-name": "Violetsky", email: "benjamin@example.com", type: "VIP", selected: false },
    { id: 15, name: "Liam Brown", "last-name": "Brownington", email: "liam@example.com", type: "Premium", selected: false },
    { id: 16, name: "Ava Cyan", "last-name": "Cyanberg", email: "ava@example.com", type: "Basic", selected: false },
    { id: 17, name: "Noah Indigo", "last-name": "Indigoworth", email: "noah@example.com", type: "VIP", selected: false },
    { id: 18, name: "Ethan Teal", "last-name": "Tealman", email: "ethan@example.com", type: "Premium", selected: false },
    { id: 19, name: "Isabella Aqua", "last-name": "Aqualina", email: "isabella@example.com", type: "Basic", selected: false },
    { id: 20, name: "Mason Navy", "last-name": "Navyton", email: "mason@example.com", type: "VIP", selected: false }
  ];

  // Initialize Table Function
  function initTable(prefix, data, columns, key, value) {
    let sortState = {};
    columns.forEach(col => { sortState[col] = 1; });

    // Pagination variables
    let rowsPerPage = 10;
    let currentPage = 0;
    const table = document.getElementById(prefix + "-table");
    const tbody = document.getElementById(prefix + "-table-body");
    const selectAll = document.getElementById(prefix + "-select-all");
    const prevButton = document.getElementById(prefix + "-prevPage");
    const nextButton = document.getElementById(prefix + "-nextPage");
    const pageIndicator = document.getElementById(prefix + "-pageIndicator");
    const perPageButton = document.getElementById(prefix + "-perPageButton");
    const perPageDropdown = document.getElementById(prefix + "-perPageDropdown");
    const perPageValue = document.getElementById(prefix + "-perPageValue");
    const resultsText = document.getElementById(prefix + "-resultsText");

    function updateResultsText() {
      if (resultsText) {
        const totalResults = data.length;
        const end = Math.min((currentPage + 1) * rowsPerPage, totalResults);
        resultsText.textContent = `showing ${end} result${totalResults > 1 ? "s" : ""}`;
      }
    }

    function renderTable(columns, key, value) {
      tbody.innerHTML = "";
      const startIndex = currentPage * rowsPerPage;
      const pageData = data.slice(startIndex, startIndex + rowsPerPage);

      pageData.forEach((item, i) => {
        const row = document.createElement("tr");
        // Checkbox column
        const checkboxCell = document.createElement("td");
        const label = document.createElement("label");
        label.className = "custom-checkbox";
        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = item.selected;
        input.addEventListener("change", function() {
          data[startIndex + i].selected = this.checked;
          updateSelectAllCheckbox();
        });
        const span = document.createElement("span");
        span.className = "checkmark";
        label.appendChild(input);
        label.appendChild(span);
        checkboxCell.appendChild(label);
        row.appendChild(checkboxCell);

        // Data columns
        columns.forEach(c => {
          const cell = document.createElement("td");
          if (c === key && item[c].toLowerCase() === value) {
            const p = document.createElement("p");
            p.textContent = item[c];
            p.classList.add("bg-[#EDF4E5]", "text-[#66893D]", "w-fit", "px-[10px]", "py-[1px]", "rounded-[10px]");
            cell.appendChild(p);
          } else {
            cell.textContent = item[c];
          }
          row.appendChild(cell);
        });

        // Action column
        const actionCell = document.createElement("td");
        const actionDiv = document.createElement("div");
        actionDiv.className = "flex gap-3 items-center";
        actionDiv.innerHTML = `
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_318_1645)">
              <path d="M12.437 0.62013L4.30902 8.74813C3.99858 9.05689 3.75247 9.42417 3.58494 9.82869C3.41741 10.2332 3.33178 10.667 3.33302 11.1048V12.0001C3.33302 12.1769 3.40326 12.3465 3.52828 12.4715C3.65331 12.5966 3.82288 12.6668 3.99969 12.6668H4.89502C5.33286 12.668 5.7666 12.5824 6.17113 12.4149C6.57565 12.2473 6.94292 12.0012 7.25169 11.6908L15.3797 3.5628C15.7693 3.17224 15.9881 2.64311 15.9881 2.09146C15.9881 1.53981 15.7693 1.01068 15.3797 0.62013C14.9835 0.241392 14.4565 0.0300293 13.9084 0.0300293C13.3602 0.0300293 12.8332 0.241392 12.437 0.62013Z" fill="#88B651"/>
              <path d="M15.3333 5.986C15.1565 5.986 14.987 6.05624 14.8619 6.18126C14.7369 6.30629 14.6667 6.47586 14.6667 6.65267V10H12C11.4696 10 10.9609 10.2107 10.5858 10.5858C10.2107 10.9609 10 11.4696 10 12V14.6667H3.33333C2.8029 14.6667 2.29419 14.456 1.91912 14.0809C1.54405 13.7058 1.33333 13.1971 1.33333 12.6667V3.33333C1.33333 2.8029 1.54405 2.29419 1.91912 1.91912C2.29419 1.54405 2.8029 1.33333 3.33333 1.33333H9.36133C9.53815 1.33333 9.70771 1.2631 9.83274 1.13807C9.95776 1.01305 10.028 0.843478 10.028 0.666667C10.028 0.489856 9.95776 0.320286 9.83274 0.195262C9.70771 0.0702379 9.53815 0 9.36133 0L3.33333 0C2.4496 0.00105857 1.60237 0.352588 0.97748 0.97748C0.352588 1.60237 0.00105857 2.4496 0 3.33333L0 12.6667C0.00105857 13.5504 0.352588 14.3976 0.97748 15.0225C1.60237 15.6474 2.4496 15.9989 3.33333 16H10.8953C11.3333 16.0013 11.7671 15.9156 12.1718 15.7481C12.5764 15.5806 12.9438 15.3345 13.2527 15.024L15.0233 13.252C15.3338 12.9432 15.58 12.576 15.7477 12.1715C15.9153 11.767 16.0011 11.3332 16 10.8953V6.65267C16 6.47586 15.9298 6.30629 15.8047 6.18126C15.6797 6.05624 15.5101 5.986 15.3333 5.986ZM12.31 14.0813C12.042 14.3487 11.7031 14.5337 11.3333 14.6147V12C11.3333 11.8232 11.4036 11.6536 11.5286 11.5286C11.6536 11.4036 11.8232 11.3333 12 11.3333H14.6167C14.5342 11.7023 14.3493 12.0406 14.0833 12.3093L12.31 14.0813Z" fill="#88B651"/>
            </g>
            <defs>
              <clipPath id="clip0_318_1645">
                <rect width="16" height="16" fill="white"/>
              </clipPath>
            </defs>
          </svg>
          <p class="text-[#4E4E4E]">Edit</p>
        `;
        actionDiv.addEventListener("click", function() {
          window.location.href = `edit/${prefix}/${item.id}`;
        });
        actionCell.appendChild(actionDiv);
        row.appendChild(actionCell);

        tbody.appendChild(row);
      });
      updateSelectAllCheckbox();
    }

    function updateSelectAllCheckbox() {
      const startIndex = currentPage * rowsPerPage;
      const pageData = data.slice(startIndex, startIndex + rowsPerPage);
      const allSelected = pageData.length > 0 && pageData.every(item => item.selected);
      selectAll.checked = allSelected;
    }

    function updatePagination() {
      pageIndicator.textContent = `Page ${currentPage + 1}`;
      if (currentPage === 0) {
        prevButton.disabled = true;
        prevButton.className = "h-[24px] p-[4px] w-[24px] rounded-[3px_0px_0px_3px] text-gray-400 bg-gray-200 cursor-not-allowed";
      } else {
        prevButton.disabled = false;
        prevButton.className = "h-[24px] p-[4px] w-[24px] rounded-[3px_0px_0px_3px] text-white bg-[#559BD0]";
      }
      if ((currentPage + 1) * rowsPerPage >= data.length) {
        nextButton.disabled = true;
        nextButton.className = "h-[24px] w-[24px] p-[2px] rounded-[0px_3px_3px_0px] text-gray-400 bg-gray-200 cursor-not-allowed";
      } else {
        nextButton.disabled = false;
        nextButton.className = "h-[24px] w-[24px] p-[2px] rounded-[0px_3px_3px_0px] text-white bg-[#559BD0]";
      }
      updateResultsText();
    }

    prevButton.addEventListener("click", () => {
      if (currentPage > 0) {
        currentPage--;
        renderTable(columns, key, value);
        updatePagination();
      }
    });

    nextButton.addEventListener("click", () => {
      if ((currentPage + 1) * rowsPerPage < data.length) {
        currentPage++;
        renderTable(columns, key, value);
        updatePagination();
      }
    });

    perPageButton.addEventListener("click", () => {
      perPageDropdown.classList.toggle("hidden");
    });

    perPageDropdown.querySelectorAll(".option").forEach(option => {
      option.addEventListener("click", function() {
        rowsPerPage = parseInt(this.getAttribute("data-value"));
        perPageValue.textContent = rowsPerPage;
        currentPage = 0;
        renderTable(columns, key, value);
        updatePagination();
        perPageDropdown.classList.add("hidden");
      });
    });

    selectAll.addEventListener("change", function() {
      const checked = this.checked;
      const startIndex = currentPage * rowsPerPage;
      data.slice(startIndex, startIndex + rowsPerPage).forEach(item => item.selected = checked);
      renderTable(columns, key, value);
    });

    function sortTable(column) {
      sortState[column] = -sortState[column];
      data.sort((a, b) => {
        let aVal = a[column].toString().toLowerCase();
        let bVal = b[column].toString().toLowerCase();
        if (aVal < bVal) return -1 * sortState[column];
        if (aVal > bVal) return 1 * sortState[column];
        return 0;
      });
      renderTable(columns, key, value);
      updateHeaderSortIndicators(column);
    }

    function updateHeaderSortIndicators(activeColumn) {
      const headers = table.querySelectorAll("th.sortable");
      headers.forEach(th => {
        th.classList.remove("asc", "desc");
        if (th.getAttribute("data-column") === activeColumn) {
          th.classList.add(sortState[activeColumn] === 1 ? "asc" : "desc");
        }
      });
    }

    const headerCells = table.querySelectorAll("th.sortable");
    headerCells.forEach(th => {
      th.addEventListener("click", function() {
        const column = this.getAttribute("data-column");
        sortTable(column);
      });
    });

    renderTable(columns, key, value);
    updatePagination();
  }

  // Call initTable using the "activity" prefix to match our element IDs
  initTable("activity", activity, ["name", "last-name", "email", "type"], "type", "vip");
</script>
