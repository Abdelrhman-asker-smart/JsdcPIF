<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Opportunity Form - Update</title>
    <link rel="stylesheet" href="./assets/css/style.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Floating label & error styles */
      .floating-input {
        display: block;
        border: 1px solid #cae0f0;
        border-radius: 12px;
        padding: 1rem 0.625rem 0.2rem;
        width: 100%;
        font-size: 16px;
        color: #000;
        font-weight: 400;
        appearance: none;
        outline: none;
        transition: border-color 0.3s;
      }
      .floating-input:focus {
        border-color: #2563eb;
      }
      .floating-input::placeholder {
        color: transparent;
      }
      .floating-label,
      .floating-label-select {
        position: absolute;
        left: 0.625rem;
        top: 1rem;
        font-size: 12px;
        color: #bbb6b0;
        pointer-events: none;
        transition: transform 0.3s, color 0.3s;
        transform-origin: 0;
      }
      .floating-input:focus ~ .floating-label,
      .floating-input:not(:placeholder-shown) ~ .floating-label {
        transform: translateY(-1rem) scale(0.75);
        color: #bbb6b0;
        font-weight: 600;
      }
      select:focus ~ .floating-label-select,
      select.float ~ .floating-label-select {
        top: 2px;
        font-size: 10px !important;
        font-weight: 600;
        color: #bbb6b0;
      }
      select:focus ~ .floating-label-select {
        color: #2563eb;
      }
      .error {
        border: 1px solid red !important;
      }
      .error-message {
        color: red;
        font-size: 12px;
        display: none;
      }
      button[disabled] {
        opacity: 0.6;
      }
      /* Drag & Drop file area style */
      .file-drop-area {
        margin-top: 1rem;
        border: 2px dashed #3b82f6;
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        background: #eef5fa;
        cursor: pointer;
        transition: background 0.3s;
      }
      .file-drop-area ~ .error{
        border:1px solid red;
      }
      .file-drop-area:hover {
        background: #dbeafe;
      }
      /* Competitor specific classes */
      .competitor-entry {
        position: relative;
        border: 1px solid #cae0f0;
        padding: 1rem;
        border-radius: 8px;
      }
      .competitor-name,
      .competitor-file {
        width: 100%;
      }
    </style>
  </head>
  <body class="bg-[#EEF5FA]">
    <div class="container bg-white p-6 rounded-2xl shadow mb-8">
      <h1 class="text-2xl font-semibold text-[#0D0D0C]">Create Opportunity</h1>
      <hr class="my-4" />
      <form id="opportunityForm" class="space-y-6">
        <!-- Fields Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Lead (Select) -->
          <div class="relative">
            <select
              id="lead"
              class="block w-full appearance-none rounded-lg floating-input text-base text-black border border-[#CAE0F0] focus:outline-none"
            >
              <option value="" selected disabled hidden></option>
              <option value="lead1">Lead 1</option>
              <option value="lead2">Lead 2</option>
            </select>
            <label for="lead" class="floating-label-select">Lead</label>
            <div class="error-message" id="leadError">This field is required.</div>
          </div>
          <!-- Stage (Select) -->
          <div class="relative">
            <select
              id="stage"
              class="block w-full appearance-none rounded-lg floating-input text-base text-black border border-[#CAE0F0] focus:outline-none"
            >
              <option value="" selected disabled hidden></option>
              <option value="stage1">Stage 1</option>
              <option value="stage2">Stage 2</option>
            </select>
            <label for="stage" class="floating-label-select">Stage</label>
            <div class="error-message" id="stageError">This field is required.</div>
          </div>
          <!-- Expected Value (Number) -->
          <div class="relative">
            <input
              type="number"
              id="expectedValueNumber"
              placeholder=" "
              class="floating-input peer"
            />
            <label for="expectedValueNumber" class="floating-label">
              Expected Value (Number)
            </label>
            <div class="error-message" id="expectedValueNumberError">
              This field is required.
            </div>
          </div>
          <!-- Expected Value (Text) -->
          <div class="relative">
            <input
              type="text"
              id="expectedValueText"
              placeholder=" "
              class="floating-input peer"
            />
            <label for="expectedValueText" class="floating-label">
              Expected Value (Text)
            </label>
            <div class="error-message" id="expectedValueTextError">
              This field is required.
            </div>
          </div>
          <!-- Status (Select) -->
          <div class="relative">
            <select
              id="status"
              class="block w-full appearance-none rounded-lg floating-input text-base text-black border border-[#CAE0F0] focus:outline-none"
            >
              <option value="" selected disabled hidden></option>
              <option value="open">Open</option>
              <option value="closed">Closed</option>
            </select>
            <label for="status" class="floating-label-select">Status</label>
            <div class="error-message" id="statusError">
              This field is required.
            </div>
          </div>
          <!-- Priority (Select) -->
          <div class="relative">
            <select
              id="priority"
              class="block w-full appearance-none rounded-lg floating-input text-base text-black border border-[#CAE0F0] focus:outline-none"
            >
              <option value="" selected disabled hidden></option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
            <label for="priority" class="floating-label-select">Priority</label>
            <div class="error-message" id="priorityError">
              This field is required.
            </div>
          </div>
          <!-- Closure Date (Date) -->
          <div class="relative">
            <input
              type="date"
              id="closureDate"
              placeholder=" "
              class="floating-input peer"
            />
            <label for="closureDate" class="floating-label">
              Closure Date
            </label>
            <div class="error-message" id="closureDateError">
              This field is required.
            </div>
          </div>
          <!-- Actual Value (Number) -->
          <div class="relative">
            <input
              type="number"
              id="actualValue"
              placeholder=" "
              class="floating-input peer"
            />
            <label for="actualValue" class="floating-label">
              Actual Value
            </label>
            <div class="error-message" id="actualValueError">
              This field is required.
            </div>
          </div>
          <!-- Loss Reason (Text) -->
          <div class="relative">
            <input
              type="text"
              id="lossReason"
              placeholder=" "
              class="floating-input peer"
            />
            <label for="lossReason" class="floating-label">
              Loss Reason
            </label>
            <div class="error-message" id="lossReasonError">
              This field is required.
            </div>
          </div>
          <!-- Assigned To (Select) -->
          <div class="relative">
            <select
              id="assignedTo"
              class="block w-full appearance-none rounded-lg floating-input text-base text-black border border-[#CAE0F0] focus:outline-none"
            >
              <option value="" selected disabled hidden></option>
              <option value="user1">User 1</option>
              <option value="user2">User 2</option>
            </select>
            <label for="assignedTo" class="floating-label-select">
              Assigned To
            </label>
            <div class="error-message" id="assignedToError">
              This field is required.
            </div>
          </div>
        </div>
        <!-- Competitors Section (Dynamic Array) -->
        <div id="competitorsSection">
          <h2 class="text-xl font-semibold mt-4">Competitors</h2>
          <div id="competitorsContainer" class="space-y-4">
            <!-- One competitor entry will be added on page load -->
          </div>
          <button
            type="button"
            class="mt-2 bg-blue-500 text-white px-4 py-2 rounded"
            onclick="addCompetitor()"
          >
            Add Competitor
          </button>
        </div>

        <!-- File Upload: Drag & Drop -->
        <div>
          <div
            id="fileDropArea"
            class="mt-1 border-2 border-dashed border-blue-500 rounded-md p-[35px] text-center bg-[#EEF5FA] cursor-pointer hover:bg-blue-100"
          >
            <input type="file" id="file" class="hidden" />
            <div class="flex flex-col justify-center items-center gap-[20px]">
              <span
                class="text-[#559BD0] font-[700] text-[20px]"
                id="fileInputLabel"
                >Drag&Drop your file or Browse</span
              >
              <div id="fileDropAreaImage">
                <svg
                  width="103"
                  height="102"
                  viewBox="0 0 103 102"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g opacity="0.2">
                    <g clip-path="url(#clip0_318_2422)">
                      <path
                        d="M81.0829 0.182739H21.4211C15.772 0.189455 10.3562 2.41947 6.36167 6.38363C2.36714 10.3478 0.120048 15.7224 0.113281 21.3286L0.113281 80.5369C0.120048 86.1431 2.36714 91.5177 6.36167 95.4818C10.3562 99.446 15.772 101.676 21.4211 101.683H81.0829C86.732 101.676 92.1478 99.446 96.1423 95.4818C100.137 91.5177 102.384 86.1431 102.391 80.5369V21.3286C102.384 15.7224 100.137 10.3478 96.1423 6.38363C92.1478 2.41947 86.732 0.189455 81.0829 0.182739V0.182739ZM21.4211 8.64107H81.0829C84.4736 8.64107 87.7255 9.97779 90.1231 12.3572C92.5207 14.7365 93.8676 17.9636 93.8676 21.3286V80.5369C93.8603 82.4209 93.4232 84.2789 92.5891 85.9714L53.5405 47.2195C51.5618 45.2554 49.2126 43.6973 46.627 42.6343C44.0415 41.5712 41.2702 41.0241 38.4716 41.0241C35.6729 41.0241 32.9017 41.5712 30.3161 42.6343C27.7306 43.6973 25.3814 45.2554 23.4027 47.2195L8.6364 61.8694V21.3286C8.6364 17.9636 9.98336 14.7365 12.3809 12.3572C14.7785 9.97779 18.0304 8.64107 21.4211 8.64107ZM21.4211 93.2244C18.0304 93.2244 14.7785 91.8877 12.3809 89.5083C9.98336 87.129 8.6364 83.9018 8.6364 80.5369V73.8294L29.4243 53.1996C30.6116 52.0206 32.0213 51.0853 33.5729 50.4472C35.1246 49.8091 36.7877 49.4806 38.4673 49.4806C40.1469 49.4806 41.8101 49.8091 43.3617 50.4472C44.9133 51.0853 46.3231 52.0206 47.5104 53.1996L86.559 91.9557C84.8536 92.7834 82.9814 93.2171 81.0829 93.2244H21.4211Z"
                        fill="#374957"
                      />
                      <path
                        d="M68.2983 44.5875C71.2483 44.5875 74.132 43.7193 76.5849 42.0929C79.0377 40.4664 80.9494 38.1546 82.0784 35.4499C83.2073 32.7452 83.5027 29.7689 82.9271 26.8976C82.3516 24.0263 80.9311 21.3888 78.8451 19.3187C76.7591 17.2486 74.1014 15.8388 71.2081 15.2677C68.3148 14.6966 65.3158 14.9897 62.5904 16.11C59.8649 17.2304 57.5355 19.1276 55.8965 21.5618C54.2576 23.996 53.3828 26.8578 53.3828 29.7854C53.3828 33.7111 54.9543 37.4761 57.7515 40.252C60.5486 43.028 64.3424 44.5875 68.2983 44.5875ZM68.2983 23.4416C69.5626 23.4416 70.7985 23.8137 71.8497 24.5107C72.9009 25.2078 73.7202 26.1986 74.204 27.3577C74.6878 28.5169 74.8144 29.7924 74.5678 31.023C74.3211 32.2535 73.7123 33.3839 72.8183 34.2711C71.9244 35.1583 70.7853 35.7624 69.5454 36.0072C68.3054 36.252 67.0201 36.1264 65.852 35.6462C64.684 35.1661 63.6856 34.353 62.9832 33.3098C62.2808 32.2665 61.9059 31.04 61.9059 29.7854C61.9059 28.1029 62.5794 26.4893 63.7782 25.2997C64.977 24.11 66.6029 23.4416 68.2983 23.4416Z"
                        fill="#374957"
                      />
                    </g>
                  </g>
                  <defs>
                    <clipPath id="clip0_318_2422">
                      <rect
                        width="102.277"
                        height="101.5"
                        fill="white"
                        transform="translate(0.113281 0.182739)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              </div>
            </div>
          </div>
          <span
            id="currentFileNameSpan"
            class="mt-2 block text-sm text-gray-700"
          ></span>
          <div class="error-message" id="fileError">
            This field is required.
          </div>
        </div>
        <span
        id="currentFileNameSpan"
        class="mt-2 block text-sm text-gray-700"
      ></span>
      <div class="error-message" id="opportunityFileError">
        This field is required.
      </div>
   
        <!-- Notes (Textarea) -->
        <div class="relative">
          <textarea
            id="notes"
            placeholder=" "
            class="block rounded-lg px-2.5 pb-2 pt-5 floating-input w-full text-base text-black border border-[#CAE0F0] peer h-32"
          ></textarea>
          <label for="notes" class="floating-label">Notes</label>
          <div class="error-message" id="notesError">
            This field is required.
          </div>
        </div>
        <!-- Details (Textarea) -->
        <div class="relative">
          <textarea
            id="details"
            placeholder=" "
            class="block rounded-lg px-2.5 pb-2 pt-5 floating-input w-full text-base text-black border border-[#CAE0F0] peer h-36"
          ></textarea>
          <label for="details" class="floating-label">Details</label>
          <div class="error-message" id="detailsError">
            This field is required.
          </div>
        </div>
        <!-- Submit Buttons -->
        <div class="flex gap-3 flex-wrap">
          <button
            type="submit"
            id="submitButton"
            class="flex-grow bg-[#559BD0] text-white px-4 py-2 rounded font-bold"
          >
            Create Opportunity
          </button>
          <a
            href="dashboard.html"
            class="flex-grow border border-[#559BD0] text-[#559BD0] px-4 py-2 rounded text-center font-bold"
          >
            Cancel
          </a>
        </div>
      </form>
    </div>
    <script>
      // Global variables for opportunity file and competitor counter
      let currentFileNameOpportunity = "";
      let competitorCounter = 1;
      
      // Standard field validation (similar to your phone logic)
      function validateField(field) {
        const errorDiv = document.getElementById(field.id + "Error");
        let valid = true;
        if (field.tagName.toLowerCase() === "select") {
          valid = field.value !== "";
        } else if (field.type === "file") {
          if (field.files && field.files.length > 0) {
            const file = field.files[0];
            if (file.size > 2 * 1024 * 1024) {
              valid = false;
              if (errorDiv) errorDiv.innerText = "File must be less than 2MB.";
            } else if (
              !["application/pdf", "image/jpeg", "image/png"].includes(file.type)
            ) {
              valid = false;
              if (errorDiv)
                errorDiv.innerText = "File must be a PDF or JPG/PNG.";
            } else {
              valid = true;
              if (errorDiv) errorDiv.innerText = "";
            }
          } else {
            valid = currentFileNameOpportunity !== "";
            if (!valid && errorDiv)
              errorDiv.innerText = "This field is required.";
          }
        } else {
          valid = field.value.trim() !== "";
        }
        if (valid) {
          field.classList.remove("error");
          if (errorDiv) errorDiv.style.display = "none";
        }
        return valid;
      }
      
      function addValidationListener(field) {
        if (
          field.tagName.toLowerCase() === "select" ||
          field.type === "file" ||
          field.type === "date"
        ) {
          field.addEventListener("change", () => validateField(field));
        } else {
          field.addEventListener("input", () => validateField(field));
        }
      }
      
      // Attach validation to standard fields
      [
        "lead",
        "stage",
        "expectedValueNumber",
        "expectedValueText",
        "status",
        "priority",
        "closureDate",
        "actualValue",
        "lossReason",
        "assignedTo",
        "opportunityFile",
        "notes",
        "details"
      ].forEach((id) => {
        const field = document.getElementById(id);
        if (field) addValidationListener(field);
      });
      
      // Drag & Drop File Upload Logic for Opportunity File
      const opportunityFileInput = document.getElementById("opportunityFile");
      const fileDropArea = document.getElementById("fileDropArea");
      const fileInputLabel = document.getElementById("fileInputLabel");
      
      fileDropArea.addEventListener("click", () => opportunityFileInput.click());
      fileDropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        fileDropArea.classList.add("bg-blue-100");
      });
      fileDropArea.addEventListener("dragleave", (e) => {
        e.preventDefault();
        fileDropArea.classList.remove("bg-blue-100");
      });
      fileDropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        fileDropArea.classList.remove("bg-blue-100");
        if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
          opportunityFileInput.files = e.dataTransfer.files;
          handleOpportunityFileChange();
        }
      });
      
      opportunityFileInput.addEventListener("change", handleOpportunityFileChange);
      
      function handleOpportunityFileChange() {
        if (opportunityFileInput.files && opportunityFileInput.files.length > 0) {
          const file = opportunityFileInput.files[0];
          currentFileNameOpportunity = file.name;
          fileInputLabel.textContent = "Selected File: " + currentFileNameOpportunity;
          if (file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("fileDropAreaImage").innerHTML =
                `<img src="${e.target.result}" alt="Image Preview" class="max-w-full max-h-48" />`;
            };
            reader.readAsDataURL(file);
          } else if (file.type === "application/pdf") {
            document.getElementById("fileDropAreaImage").innerHTML =
              `<svg width="100" height="100">
                <rect width="100" height="100" rx="15" fill="#E53E3E"/>
                <text x="50" y="60" text-anchor="middle" fill="white" font-size="40" font-family="Arial" font-weight="bold">PDF</text>
              </svg>`;
          } else {
            document.getElementById("fileDropAreaImage").innerHTML =
              `<svg width="103" height="102" fill="#cae0f0">
                <rect width="103" height="102" rx="12"/>
              </svg>`;
          }
        } else {
          currentFileNameOpportunity = "";
          fileInputLabel.textContent = "Drag & Drop your file or Browse";
          document.getElementById("fileDropAreaImage").innerHTML =
            `<svg width="103" height="102" fill="#cae0f0">
              <rect width="103" height="102" rx="12"/>
            </svg>`;
        }
        validateField(opportunityFileInput);
      }
      
      // Competitors dynamic field logic â€“ similar to phone fields
      function addCompetitor() {
        const container = document.getElementById("competitorsContainer");
        const competitorDiv = document.createElement("div");
        competitorDiv.className = "competitor-entry";
      
        // Competitor Name Input
        const nameDiv = document.createElement("div");
        nameDiv.className = "relative mb-4";
        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = " ";
        nameInput.className = "floating-input peer competitor-name";
        const nameLabel = document.createElement("label");
        nameLabel.innerText = "Competitor Name";
        nameLabel.className = "floating-label";
        nameDiv.appendChild(nameInput);
        nameDiv.appendChild(nameLabel);
        const nameError = document.createElement("div");
        nameError.className = "error-message";
        nameError.innerText = "This field is required.";
        nameDiv.appendChild(nameError);
      
        // Competitor Attachment Input
        const fileDiv = document.createElement("div");
        fileDiv.className = "relative";
        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.className = "competitor-file";
        fileDiv.appendChild(fileInput);
        const fileError = document.createElement("div");
        fileError.className = "error-message";
        fileError.innerText = "File is required.";
        fileDiv.appendChild(fileError);
      
        competitorDiv.appendChild(nameDiv);
        competitorDiv.appendChild(fileDiv);
      
        // Append delete button only if there is at least one competitor already.
        if (container.children.length > 0) {
          const deleteDiv = document.createElement("div");
          deleteDiv.className = "deleteBtn cursor-pointer absolute top-0 right-0";
          deleteDiv.innerHTML = `
            <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_723_4826)">
                <path d="M13.9987 2.84928H11.932C11.7773 2.09689 11.3679 1.42085 10.7729 0.935096C10.1778 0.449344 9.4335 0.183587 8.66536 0.182617L7.33203 0.182617C6.56389 0.183587 5.81958 0.449344 5.22453 0.935096C4.62948 1.42085 4.2201 2.09689 4.06536 2.84928H1.9987C1.82189 2.84928 1.65232 2.91952 1.52729 3.04455C1.40227 3.16957 1.33203 3.33914 1.33203 3.51595C1.33203 3.69276 1.40227 3.86233 1.52729 3.98735C1.65232 4.11238 1.82189 4.18262 1.9987 4.18262H2.66536V12.8493C2.66642 13.733 3.01795 14.5802 3.64284 15.2051C4.26774 15.83 5.11497 16.1816 5.9987 16.1826H9.9987C10.8824 16.1816 11.7297 15.83 12.3546 15.2051C12.9794 14.5802 13.331 13.733 13.332 12.8493V4.18262H13.9987C14.1755 4.18262 14.3451 4.11238 14.4701 3.98735C14.5951 3.86233 14.6654 3.69276 14.6654 3.51595C14.6654 3.33914 14.5951 3.16957 14.4701 3.04455C14.3451 2.91952 14.1755 2.84928 13.9987 2.84928ZM7.33203 1.51595H8.66536C9.07888 1.51646 9.48212 1.64487 9.81977 1.88358C10.1574 2.12229 10.413 2.45961 10.5514 2.84928H5.44603C5.58442 2.45961 5.83996 2.12229 6.17762 1.88358C6.51528 1.64487 6.91851 1.51646 7.33203 1.51595Z" fill="#E4899C"/>
                <path d="M6.66667 12.1822C6.84348 12.1822 7.01304 12.112 7.13807 11.9869C7.26309 11.8619 7.33333 11.6923 7.33333 11.5155V7.51554C7.33333 7.33873 7.26309 7.16916 7.13807 7.04414C7.01304 6.91911 6.84348 6.84888 6.66667 6.84888C6.48985 6.84888 6.32029 6.91911 6.19526 7.04414C6.07024 7.16916 6 7.33873 6 7.51554V11.5155C6 11.6923 6.07024 11.8619 6.19526 11.9869C6.32029 12.112 6.48985 12.1822 6.66667 12.1822Z" fill="#E4899C"/>
                <path d="M9.33464 12.1822C9.51145 12.1822 9.68102 12.112 9.80605 11.9869C9.93107 11.8619 10.0013 11.6923 10.0013 11.5155V7.51554C10.0013 7.33873 9.93107 7.16916 9.80605 7.04414C9.68102 6.91911 9.51145 6.84888 9.33464 6.84888C9.15783 6.84888 8.98826 6.91911 8.86323 7.04414C8.73821 7.16916 8.66797 7.33873 8.66797 7.51554V11.5155C8.66797 11.6923 8.73821 11.8619 8.86323 11.9869C8.98826 12.112 9.15783 12.1822 9.33464 12.1822Z" fill="#E4899C"/>
              </g>
              <defs>
                <clipPath id="clip0_723_4826">
                  <rect width="16" height="16" fill="white" transform="translate(0 0.182617)"/>
                </clipPath>
              </defs>
            </svg>
            <p class='text-[12px] text-[#BBB6B0] font-[600]'>Delete</p>
          `;
          deleteDiv.onclick = function () {
            competitorDiv.remove();
          };
          competitorDiv.appendChild(deleteDiv);
        }
      
        container.appendChild(competitorDiv);
        competitorCounter++;
      }
      
      // Ensure at least one competitor entry is present on page load.
      document.addEventListener("DOMContentLoaded", function () {
        if (document.getElementById("competitorsContainer").children.length === 0) {
          addCompetitor();
        }
      });
      
      // Form submission with re-indexing competitor entries.
      document.getElementById("opportunityForm").addEventListener("submit", function (event) {
        event.preventDefault();
        let firstError = null;
        const fieldIds = [
          "lead",
          "stage",
          "expectedValueNumber",
          "expectedValueText",
          "status",
          "priority",
          "closureDate",
          "actualValue",
          "lossReason",
          "assignedTo",
          "opportunityFile",
          "notes",
          "details"
        ];
        fieldIds.forEach((id) => {
          const field = document.getElementById(id);
          if (field && !validateField(field)) {
            field.classList.add("error");
            const errorDiv = document.getElementById(id + "Error");
            if (errorDiv) errorDiv.style.display = "block";
            if (!firstError) firstError = field;
          }
        });
      
        // Validate competitor entries.
        const competitorEntries = document.querySelectorAll(".competitor-entry");
        competitorEntries.forEach((entry) => {
          const nameInput = entry.querySelector(".competitor-name");
          const fileInput = entry.querySelector(".competitor-file");
          if (nameInput && nameInput.value.trim() === "") {
            nameInput.classList.add("error");
            const err = nameInput.nextElementSibling;
            if (err) err.style.display = "block";
            if (!firstError) firstError = nameInput;
          }
          if (fileInput && fileInput.files.length === 0) {
            fileInput.classList.add("error");
            const err = fileInput.nextElementSibling;
            if (err) err.style.display = "block";
            if (!firstError) firstError = fileInput;
          }
        });
      
        if (firstError) {
          firstError.focus();
          return;
        }
      
        const formData = new FormData(document.getElementById("opportunityForm"));
      
        // Re-index competitor entries so their keys are sequential.
        competitorEntries.forEach((entry, index) => {
          const nameInput = entry.querySelector(".competitor-name");
          const fileInput = entry.querySelector(".competitor-file");
          formData.append(`competitors[${index}][name]`, nameInput.value);
          if (fileInput.files.length > 0) {
            formData.append(`competitors[${index}][file]`, fileInput.files[0]);
          }
        });
      
        // For debugging: log all formData entries.
        for (let [key, value] of formData.entries()) {
          console.log(key, value);
        }
      
        // Simulate form submission.
        const submitButton = document.getElementById("submitButton");
        submitButton.disabled = true;
        submitButton.innerText = "Creating...";
        setTimeout(() => {
          submitButton.disabled = false;
          submitButton.innerText = "Create Opportunity";
          alert("Opportunity Created Successfully!");
        }, 2000);
      });
    </script>
  </body>
</html>
